<template name="Messages_Page">
  {{#if Template.subscriptionsReady}}
  {{#if hasTutorial}}
  <div class="ui yellow message transition container">
    <p style="font-size: 14px;">Want to turn off tutorials? Toggle the tutorials on and off with the rightmost button of
      the top menu. </p>
    <i class="close icon"></i>
    <div class="header">
      <h1>Tutorial</h1>
    </div>
    <p>Here you can chat with all other online users. Please be polite!</p>
  </div>
  {{/if}}

  <div class="ui raised container">
    <div id="message-scrolling" class="ui grid fluid segment scrolling" style="margins:10px; padding:10px;">

      {{#each message in messagesList}}
      {{#if ifUser message.user}}
      <div class="ui two column row">
        <div class="right floated column">
          <img class="ui avatar right floated image" src="{{getUserAvatar message.user}}">
          <div class="ui compact blue message" style="text-align: right; float:right;">
            <div class="content">
              <div class="header">{{message.user}}:</div>
            <p>{{message.message}}</p>
            </div>
          </div>
        </div>
      </div>
        {{else}}
      <div class="ui two column row">
        <div class="left floated column">
        <img class="ui left floated avatar image" src="{{getUserAvatar message.user}}">
        <div class="ui compact red message">
          <div class="content">
            <div class="header">
             {{message.user}}:
            </div>
            <p>{{message.message}}</p>
          </div>
        </div>
        </div>
      </div>
      {{/if}}
      {{updateScroll}}
      {{clearThis}}
      {{/each}}
    </div>
    <form class="new-message">
      <div class="ui large fluid action icon input">
        <input type="text" placeholder="Message" id="message" name="message">
        <i class="send icon"></i>
      </div>
    </form>
  </div>
  <script>
    $('.menu .vertical .item').tab();
    $('.message .close')
        .on('click', function () {
          $(this)
              .closest('.message')
              .transition('fade')
          ;
        })
    ;
    $(function(){
      $(".scrolling").jScrollPane();
    });
    $(".scrolling").animate({ scrollTop: $(document).height() }, "slow");
    return false;
  </script>
  {{updateScroll}}
  {{else}}
  {{> Loading}}
  {{/if}}
</template>